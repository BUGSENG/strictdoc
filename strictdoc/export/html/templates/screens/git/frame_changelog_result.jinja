<turbo-frame id="diff_result">
{% if results %}
  <style>
    table.changelog {
        border-collapse: collapse;
    }
    table.changelog td {
        border: 1px solid gray;
        padding: 8px;
    }
  </style>

  <div class="diff_column">
  <div class="diff_inner">
  <h3>Changelog</h3>

  <h4>Compared revisions</h4>
  <p>Left: {{ left_revision }}</p>
  <p>Right: {{ right_revision }}</p>

  <h4>Summary of the changes</h4>
  <div>
    {{ change_container.change_stats.get_total_changes() }} nodes modified:
    <ul>
      {% set documents_modified = change_container.change_stats.get_changes_documents_modified() %}
      <li>
        {% if documents_modified is not none %}
          {{ documents_modified }} documents.
        {% else %}
          No documents were modified.
        {% endif %}
      </li>

      {% set sections_modified = change_container.change_stats.get_changes_sections_modified() %}
      <li>
        {% if sections_modified is not none %}
          {{ sections_modified }} sections
          ({{ change_container.change_stats.get_changes_sections_stats_string() }}).
        {% else %}
          No sections were modified.
        {% endif %}
      </li>

      {% set requirements_modified = change_container.change_stats.get_changes_requirements_changed() %}
      <li>
        {% if requirements_modified is not none %}
          {{ requirements_modified }} requirements
          ({{ change_container.change_stats.get_changes_requirements_stats_string() }}).
        {% else %}
          No requirements were modified.
        {% endif %}
      </li>
    </ul>
  </div>

  <h3>Changes</h3>

  <table class="changelog">

  {% for change in change_container.change_stats.changes %}
    <tr>
      <td>Change #{{ loop.index }}</td>

      <td>{{ change.change_type.value }}</td>

      {% if change.change_type == "Requirement added" %}
        <td>
          –
        </td>

        <td>
          {% with requirement=change.rhs_requirement, side="right", self_stats=change_container.rhs_stats, other_stats=change_container.lhs_stats, traceability_index=change_container.traceability_index_rhs %}
          {% include "screens/git/node/requirement.jinja" %}
          {% endwith %}
        </td>
      {% elif change.change_type == "Requirement removed" %}
        <td>
          {% with requirement=change.lhs_requirement, side="left", self_stats=change_container.lhs_stats, other_stats=change_container.rhs_stats, traceability_index=change_container.traceability_index_lhs %}
             {% include "screens/git/node/requirement.jinja" %}
          {% endwith %}
        </td>

        <td>
          –
        </td>
      {% elif change.change_type == "Requirement modified" %}
        <td>
          {% with requirement=change.lhs_requirement, side="left", self_stats=change_container.lhs_stats, other_stats=change_container.rhs_stats, traceability_index=change_container.traceability_index_lhs %}
          {% include "screens/git/node/requirement.jinja" %}
          {% endwith %}
        </td>
        <td>
          {% with requirement=change.rhs_requirement, side="right", self_stats=change_container.rhs_stats, other_stats=change_container.lhs_stats, traceability_index=change_container.traceability_index_rhs %}
          {% include "screens/git/node/requirement.jinja" %}
          {% endwith %}
        </td>
      {% elif change.change_type == "Section removed" %}
        <td>
          {% with section=change.lhs_section, side="left", self_stats=change_container.lhs_stats, other_stats=change_container.rhs_stats, traceability_index=change_container.traceability_index_lhs %}
          {% include "screens/git/node/section.jinja" %}
          {% endwith %}
        </td>
        <td>–</td>
      {% elif change.change_type == "Section modified" %}
        <td>
          {% with section=change.lhs_section, side="left", self_stats=change_container.lhs_stats, other_stats=change_container.rhs_stats, traceability_index=change_container.traceability_index_lhs %}
          {% include "screens/git/node/section.jinja" %}
          {% endwith %}
        </td>
        <td>
          {% with section=change.rhs_section, side="right", self_stats=change_container.rhs_stats, other_stats=change_container.lhs_stats, traceability_index=change_container.traceability_index_rhs %}
          {% include "screens/git/node/section.jinja" %}
          {% endwith %}
        </td>
      {% elif change.change_type == "Section added" %}
        <td>–</td>
        <td>
          {% with section=change.rhs_section, side="right", self_stats=change_container.rhs_stats, other_stats=change_container.lhs_stats, traceability_index=change_container.traceability_index_rhs %}
          {% include "screens/git/node/section.jinja" %}
          {% endwith %}
        </td>
      {% elif change.change_type == "Document modified" %}
        <td>
          {% if change.lhs_document is not none %}
            {% with document=change.lhs_document, side="left", self_stats=change_container.lhs_stats, other_stats=change_container.rhs_stats, traceability_index=change_container.traceability_index_lhs %}
              {% include "screens/git/fields/document_abstract.jinja" %}
            {% endwith %}
          {% else %}
            –
          {% endif %}
        </td>
        <td>
          {% if change.rhs_document is not none %}
            {% with document=change.rhs_document, side="right", self_stats=change_container.rhs_stats, other_stats=change_container.lhs_stats, traceability_index=change_container.traceability_index_rhs %}
              {% include "screens/git/fields/document_abstract.jinja" %}
            {% endwith %}
          {% else %}
            –
          {% endif %}
        </td>
      {% else %}
        {% assert 0, "Must not reach here." %}
      {% endif %}
    </tr>
  {% endfor %}

  </table>
  </div>
  </div>

{% endif %}
</turbo-frame>
