{%- if is_new_requirement -%}
  {%- set url="/actions/document/create_requirement" %}
{%- else -%}
  {%- set url="/actions/document/update_requirement" %}
{%- endif -%}

<turbo-frame id="article-{{form_object.requirement_mid}}">
<sdoc-form>

<form
  action="{{url}}"
  method="POST"
  data-turbo="true"
>
  {%- if is_new_requirement -%}
    <input type="hidden" id="reference_mid" name="reference_mid" value="{{reference_mid}}" />
    <input type="hidden" id="whereto" name="whereto" value="{{whereto}}" />
  {%- endif -%}
  <input type="hidden" id="requirement_mid" name="requirement_mid" value="{{form_object.requirement_mid}}" />

  {%- for field_values in form_object.enumerate_fields(multiline=False) -%}
    {%- for field in field_values -%}
      {%- with
        field_class_name="",
        field_name=field.field_name,
        field_input_name="requirement[" ~ field.field_name ~ "]",
        field_value=field.field_value,
        errors=form_object.get_errors(field.field_name)
      -%}
        {% include "_helpers/singleline_field.jinja.html" %}
      {%- endwith -%}
    {%- endfor -%}
  {%- endfor -%}

  <hr/>

  {%- for field in form_object.enumerate_reference_fields() -%}
    {% include "_shared/requirement_edit_field_parent_link.jinja.html" %}
  {%- endfor -%}

  <div id="requirement_{{form_object.requirement_mid}}__new_parent_link"></div>
  <a
    href="/actions/document/new_parent_link?requirement_mid={{form_object.requirement_mid}}"
    data-turbo-action="replace"
    data-turbo="true"
    data-testid="requirement-add-parent-link-action"
  >Add parent link</a>

  <hr/>

  {%- for field_values in form_object.enumerate_fields(multiline=True) -%}
    {%- for field in field_values -%}
      {%- with
        field_class_name="test",
        field_name=field.field_name,
        field_input_name="requirement[" ~ field.field_name ~ "]",
        field_value=field.field_value,
        errors=form_object.get_errors(field.field_name)
      -%}
        {% include "_helpers/multiline_field.jinja.html" %}
      {%- endwith -%}
    {%- endfor -%}
  {%- endfor -%}

  <div id="requirement_{{form_object.requirement_mid}}__new_comment"></div>

  <a href="/actions/document/new_comment?requirement_mid={{form_object.requirement_mid}}" data-turbo-action="replace" data-turbo="true">Add comment</a>

  <sdoc-form-footer>
    <button
      class="std-form-btn"
      type="submit"
      data-testid="form-submit-action"
    >Save</button>

    {%- if is_new_requirement -%}
      <a
        class="std-form-btn"
        href="/actions/document/cancel_new_requirement?requirement_mid={{form_object.requirement_mid}}"
        data-turbo="true"
        data-testid="form-cancel-action"
      >Cancel</a>
    {%- else -%}
      <a
        class="std-form-btn"
        href="/actions/document/cancel_edit_requirement?requirement_mid={{form_object.requirement_mid}}"
        data-turbo="true"
        data-testid="form-cancel-action"
      >Cancel</a>
    {%- endif -%}
  </sdoc-form-footer>
</form>

</sdoc-form>
</turbo-frame>
